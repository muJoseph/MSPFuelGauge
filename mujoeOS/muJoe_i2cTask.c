/*
 * muJoe_i2cTask.c
 *
 *  Created on: Nov 18, 2017
 *      Author: joe
 */



////////////////////////////////////////////////////////////////////////////////////////////////
// INCLUDE
////////////////////////////////////////////////////////////////////////////////////////////////

#include "muJoe_i2cTask.h"

////////////////////////////////////////////////////////////////////////////////////////////////
// STATIC FUNCTION PROTOS
////////////////////////////////////////////////////////////////////////////////////////////////

static void i2cTask_masterWriteHandler( void );

////////////////////////////////////////////////////////////////////////////////////////////////
// EXTERN VAR
////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////
// GLOBAL VAR
////////////////////////////////////////////////////////////////////////////////////////////////

uint8 i2cTask_taskId = 0;

////////////////////////////////////////////////////////////////////////////////////////////////
// LOCAL VAR
////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////
// FUNCTIONS
////////////////////////////////////////////////////////////////////////////////////////////////

void i2cTask_init( uint8 taskId )
{
    i2cTask_taskId = taskId;

    // Init Task Here

} // i2cTask_init

uint16 i2cTask_evtProcessor( uint8 taskId, uint16 events )
{
    // I2C Master Write Event
    if( events & I2CTASK_HANDLE_MASTER_WRITE_EVT )
    {
        i2cTask_masterWriteHandler();
        return (events ^ I2CTASK_HANDLE_MASTER_WRITE_EVT);
    }

    // Discard unknown events
    return 0;

} // i2cTask_evtProcessor

////////////////////////////////////////////////////////////////////////////////////////////////
// STATIC FUNCTIONS
////////////////////////////////////////////////////////////////////////////////////////////////

static void i2cTask_masterWriteHandler( void )
{
    i2cSlave_rxdPacketHandler();

} // i2cTask_masterWriteHandler


////////////////////////////////////////////////////////////////////////////////////////////////
// CALLBACK FUNCTIONS
////////////////////////////////////////////////////////////////////////////////////////////////

// Called when Configuration I2C register is written to by
// I2C bus master
void mspfg_configRegWriteCb( uint8 regData )
{
    // Enable/disable HW interrupt generation via MSP_INTn pin
    if( regData & MSPFG_CFG_EN_HW_INT )
    {
        // Disable internal PU/PD resistor
        P2REN &= ~P2_3_MSP_INTn;
        // Configure MSP_INTn as OUTPUT
        P2DIR |= P2_3_MSP_INTn;
        // Init GPIO as HIGH
        P2OUT |= P2_3_MSP_INTn;

        putBreakPtHere();               // Debug
    }
    else
    {
        // Configure MSP_INTn as INPUT
        P2DIR &= ~P2_3_MSP_INTn;
        // Enable internal PU/PD resistor
        P2REN |= P2_3_MSP_INTn;
        // Set internal resistor to pull-up
        P2OUT |= P2_3_MSP_INTn;
    }

} // mspfg_configRegWriteCb

// Called when Fuel Level Critical Threshold I2C register
// is written to by I2C bus master
void mspfg_fuelLvlCritThreshRegWriteCb( uint8 regData )
{
    putBreakPtHere();                   // Debug

} // mspfg_fuelLvlCritThreshRegWriteCb

// Called when Status I2C register
// is written to by I2C bus master
void mspfg_statusRegWriteCb( uint8 regData )
{
    // If I2C Bus Master has cleared HW interrupt flag, de-assert HW line
    if( ( regData & MSPFG_STAT_HW_INT_PENDING ) == 0x00 )
        MSPINTn_bringHIGH();

    putBreakPtHere();                   // Debug

}// mspfg_statusRegWriteCb
